{% extends "layout.html" %}
{% block content %}



<style>
/* ---------- TABLE ---------- */
.appointments-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
    margin-top: 1rem;
}
.appointments-table th {
    text-align: left;
    padding: 10px 8px;
    border-bottom: 2px solid #ddd;
}
.appointments-table td {
    padding: 10px 8px;
    border-bottom: 1px solid #eee;
}

/* ---------- STATUS ---------- */
.status-active { color: green; font-weight: 600; }
.status-canceled { color: #b00; font-weight: 600; }

/* ---------- ACTION BUTTONS ---------- */
.btn-action {
    background: #f1f1f1;
    border: 1px solid #ccc;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
}
.btn-action:hover {
    background: #e3e3e3;
}

/* Color variations */
.btn-cancel {
    background: #ffe5e5;
    border-color: #d88;
}
.btn-cancel:hover {
    background: #ffd6d6;
}

.btn-reschedule {
    background: #e6f0ff;
    border-color: #88aadd;
}
.btn-reschedule:hover {
    background: #d6e8ff;
}
</style>


<main class="container" style="max-width:950px; margin:40px auto; padding:18px;">
    <h1>My Appointments</h1>

    <p class="text-muted mb-3">
    You currently have <strong>{{ active_count }}</strong> of
    <strong>{{ max_allowed }}</strong> active exam registrations.
    {% if remaining_slots > 0 %}
    You can still book <strong>{{ remaining_slots }}</strong> more exam{{ 's' if remaining_slots != 1 else '' }}.
    {% else %}
    You have reached the maximum number of active registrations allowed by the Exam Registration System.
    {% endif %}
    </p>


    <!-- Filters -->
    <form method="get" action="{{ url_for('student_ui.student_appointments') }}"
          style="margin: 1rem 0; display:flex; gap:0.5rem; flex-wrap:wrap;">
        <input type="search" name="q" placeholder="Search exam or course" value="{{ q or '' }}">
        <input type="date" name="start" value="{{ start or '' }}">
        <input type="date" name="end" value="{{ end or '' }}">

        <button type="submit">Filter</button>
        <a href="{{ url_for('student_ui.student_appointments') }}" class="reset-link">Reset</a>
    </form>


    {% if bookings %}
    <table class="appointments-table">
        <thead>
            <tr>
                <th>Confirmation</th>
                <th>Course</th>
                <th>Exam</th>
                <th>Professor</th>
                <th>Date</th>
                <th>Time</th>
                <th>Location</th>
                <th>Status</th>
                <th style="text-align:center;">Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for b in bookings %}
        <tr>
            <td>{{ b.confirmation_code }}</td>
            <td>{{ b.course_code }}</td>
            <td>{{ b.exam_type }}</td>
            <td>{{ b.professor_name }}</td>
            <td>{{ b.exam_date }}</td>
            <td>{{ b.exam_time or '—' }}</td>
            <td>{{ b.full_location }}</td>

            <td>
                {% if b.status == 'Active' %}
                    <span class="status-active">Active</span>
                {% else %}
                    <span class="status-canceled">Canceled</span>
                {% endif %}
            </td>

            <td style="text-align:center; white-space:nowrap;">

                {% if b.status == 'Active' %}

                <!-- CANCEL — uses modal -->
                <form method="POST"
                      action="{{ url_for('student_ui.cancel_appointment', reg_id=b.reg_id) }}"
                      class="cancel-form"
                      style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="button"
                            class="btn-action btn-cancel"
                            onclick="openCancelModal(this.form)">
                        Cancel
                    </button>
                </form>

                <!-- RESCHEDULE — same styling -->
                <form method="POST"
                      action="{{ url_for('student_ui.start_reschedule', reg_id=b.reg_id) }}"
                      style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn-action btn-reschedule">
                        Reschedule
                    </button>
                </form>

                {% else %}
                    <span style="color:#777;">—</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
        <p>No appointments found.</p>
    {% endif %}
</main>

{% endblock %}
